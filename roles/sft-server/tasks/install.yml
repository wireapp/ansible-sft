- name: copying SFT artifact
  copy:
    src: "{{ sft_artifact_file_path }}"
    dest: "{{ SFT_ARTIFACT_TARGET_PATH }}"
  when:
    - sft_artifact_file_path is defined
    - sft_version is not defined
    - sft_artifact_file_url is not defined
    - sft_artifact_checksum is not defined

- name: downloading SFT artifact by version
  # get_url
  debug:
    msg: "TODO"
  when:
    - sft_version is defined
    - sft_artifact_file_path is not defined
    - sft_artifact_file_url is not defined
    - sft_artifact_checksum is not defined

- name: downloading SFT artifact by URL
  # get_url
  debug:
    msg: "TODO"
  when:
    - sft_artifact_file_url is defined
    - sft_artifact_checksum is defined
    - sft_artifact_file_path is not defined
    - sft_version is not defined


- name: unpacking artifact
  unarchive:
    remote_src: yes
    src: "{{ SFT_ARTIFACT_TARGET_PATH }}"
    dest: '/tmp/'
    list_files: yes
  register: unpacked

- name: copying executable to right location
  copy:
    src: "{{ unpacked.dest }}{{ unpacked.files[0] }}"
    remote_src: yes
    dest: "{{ SFT_BIN_PATH }}"

- name: ensuring executable state
  file:
    path: "{{ SFT_BIN_PATH }}"
    state: 'file'
    owner: "{{ SFTD_USER }}"
    group: "{{ SFTD_GROUP }}"
    mode: '550'
  notify:
    - configuration changed

- name: copying systemd service unit
  template:
    src: 'service.unit.j2'
    dest: "/etc/systemd/system/{{ service_name }}.service"
    owner: root
    group: root
    mode: '644'
  register: unit
  notify:
    - configuration changed
